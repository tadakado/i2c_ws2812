# i2c_ws2812

I2C to WS2812 (RGB LED) converter

## MCU and Peripherals ###

The code is tested on ATtiny 0 & 1 series (ATtiny212 & ATtiny402).
I2C, CCL, SPI, and TCA peripherals are used.

## I2C ###

### Write RGB data

Each register for a LED has 3-byte data. You can send <LED #> <Green> <Red> <Blue> after the slave address (0x08).
Multiple LED data can be transfered without specifying the next LED.
That is, 0x00 <Green 0> <Red 0> <Blue 0> <Green 1> <Red 2> <Blue 3> ... .
Data exceeding the limit of the memory will be omitted.
The maximum number of LEDs (Max_LEDs) for ATtiny202/212 and ATtiny402/412 are 29 and 71, respectively.
The numbers will change in other MCUs or with code modifications.

### Send RGB data to WS2812

When writing the number of LEDs (Num_of_LEDs) to the special register (0xff), the controller starts to send the data to WS2812.

### Registers

| Register | Reg0 | Reg1 | ... | Reg28 | ... | Reg255 |
| - | - | - | - | - | - | - |
| Data (write) | G0, R0, B0 | G1, R1, B1 | ... | G28, R28, B28 | ... | Num_of_LEDs |
| Data (read) | G0, R0, B0 | G1, R1, B1 | ... | G28, R28, B28 | ... | Max_LEDs (29 or 71) |

##  WS2812 (RGB LED) ###

The control signal for WS2812 is generated by CCL described in the reference.
Reference: Microchip Application Notes AN2387 http://ww1.microchip.com/downloads/jp/AppNotes/00002387A_JP.pdf http://ww1.microchip.com/downloads/en/Appnotes/00002387B.pdf

## Pin assignments

| Name | Pin | Function |
| - | - | - |
| PA0 | 6 | (SPI SS) (UPDI) |
| PA1 | 4 | I2C SDA * | 
| PA2 | 5 | I2C SCL * | 
| PA3 | 7 | (SPI SCK) |
| PA6 | 2 | (SPI MOSI) |
| PA7 | 3 | (SPI MISO) CCL LUT1-OUT [WS2812 RGB LEDs] * |

\* 3 pins for I2C and WS2812.

    ATtiny202/212/402/412
           ┌────┐
        VCC│1  8│GND
           │2  7│
     WS2812│3  6│
    I2C SDA│4  5│I2C SCL
           └────┘

## Test

Test code for I2C master is in the Arduino sketch "arduino/I2C_test_master.ino".

## Hex files

Hex files for ATtiny202/212 and ATtiny402/412 are available.
